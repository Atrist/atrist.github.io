(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{490:function(s,t,a){s.exports=a.p+"assets/img/jwtDemo.61e3b1e1.png"},540:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"讲讲前后端鉴权的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#讲讲前后端鉴权的问题"}},[s._v("#")]),s._v(" 讲讲前后端鉴权的问题")]),s._v(" "),n("h3",{attrs:{id:"跨域身份验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域身份验证"}},[s._v("#")]),s._v(" 跨域身份验证:")]),s._v(" "),n("ol",[n("li",[s._v("用户向服务器发送用户名和密码。")]),s._v(" "),n("li",[s._v("验证服务器后，相关数据（如用户角色，登录时间等）将保存在当前会话中")]),s._v(" "),n("li",[s._v("服务器向用户返回 session_id，session 信息都会写入到用户的 Cookie")]),s._v(" "),n("li",[s._v("用户的每个后续请求都将通过在 Cookie 中取出 session_id 传给服务器")]),s._v(" "),n("li",[s._v("服务器收到 session_id 并对比之前保存的数据，确认用户的身份")])]),s._v(" "),n("h2",{attrs:{id:"cookie-以及-session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cookie-以及-session"}},[s._v("#")]),s._v(" cookie 以及 session")]),s._v(" "),n("h2",{attrs:{id:"jwt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jwt"}},[s._v("#")]),s._v(" JWT")]),s._v(" "),n("p",[s._v("JWT 的原则是在服务器身份验证之后，将生成一个 JSON 对象并将其发送回用户")]),s._v(" "),n("h2",{attrs:{id:"jwt-在-nodejs-中实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jwt-在-nodejs-中实现"}},[s._v("#")]),s._v(" JWT 在 nodejs 中实现")]),s._v(" "),n("p",[s._v("需要使用到两个包:")]),s._v(" "),n("ol",[n("li",[s._v("koa-jwt")]),s._v(" "),n("li",[s._v("jsonwebtoken")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/auth0/node-jsonwebtoken",target:"_blank",rel:"noopener noreferrer"}},[s._v("jsonwebToken 的 github 地址"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"koa-jwt-的配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-jwt-的配置"}},[s._v("#")]),s._v(" koa-jwt 的配置:")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("jwt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unless")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/\\/users\\/register/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[s._v("/\\/users\\/login/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("unless: 指的是不需要鉴权的 url,也即是 public API"),n("br"),s._v("\nsecret: 在后面使用 jsonwebtoken 签发证书的时候,需要保持一致")]),s._v(" "),n("h3",{attrs:{id:"生成-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成-token"}},[s._v("#")]),s._v(" 生成 token")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jwtToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" userOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    exp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("exp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("secret\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"解压-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解压-token"}},[s._v("#")]),s._v(" 解压 token")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  user "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jwtToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("verify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2002"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"登录时间过期,请重新登录"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"前端调用接口的格式-authorization-bearer-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端调用接口的格式-authorization-bearer-token"}},[s._v("#")]),s._v(" 前端调用接口的格式: "),n("code",[s._v("Authorization: Bearer <token>")])]),s._v(" "),n("p",[s._v("此字段需要出现在 "),n("code",[s._v("header")])]),s._v(" "),n("p",[s._v("一个简单例子:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(490),alt:""}})]),s._v(" "),n("p",[s._v("js 代码的方式:")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"auth"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#auth"}},[s._v("#")]),s._v(" Auth")])])}),[],!1,null,null,null);t.default=e.exports}}]);